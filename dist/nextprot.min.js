/*! nextprot 2015-08-05 */
!function(a){"use strict";void 0===a.Nextprot&&(a.Nextprot={}),function(){var b="https://api.nextprot.org//entry/",c="https://api.nextprot.org/sparql",d="?output=json",e="PREFIX :<http://nextprot.org/rdf#> PREFIX annotation:<http://nextprot.org/rdf/annotation/> PREFIX context:<http://nextprot.org/rdf/context/> PREFIX cv:<http://nextprot.org/rdf/terminology/> PREFIX db:<http://nextprot.org/rdf/db/> PREFIX dc:<http://purl.org/dc/elements/1.1/> PREFIX dcterms:<http://purl.org/dc/terms/> PREFIX entry:<http://nextprot.org/rdf/entry/> PREFIX evidence:<http://nextprot.org/rdf/evidence/> PREFIX foaf:<http://xmlns.com/foaf/0.1/> PREFIX gene:<http://nextprot.org/rdf/gene/> PREFIX identifier:<http://nextprot.org/rdf/identifier/> PREFIX isoform:<http://nextprot.org/rdf/isoform/> PREFIX mo:<http://purl.org/ontology/mo/> PREFIX ov:<http://open.vocab.org/terms/> PREFIX owl:<http://www.w3.org/2002/07/owl#> PREFIX publication:<http://nextprot.org/rdf/publication/> PREFIX rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> PREFIX sim:<http://purl.org/ontology/similarity/> PREFIX source:<http://nextprot.org/rdf/source/> PREFIX xref:<http://nextprot.org/rdf/xref/> PREFIX xsd:<http://www.w3.org/2001/XMLSchema#> ",f=null,g=null,h=function(a,b){if(f=a,g=b,!a)throw"Please provide some application name  ex:  new Nextprot.Client('demo application for visualizing peptides', clientInformation);";if(!b)throw"Please provide some client information ex:  new Nextprot.Client(applicationName, 'Calipho SIB at Geneva');"},i=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))};h.prototype.getEntryName=function(){return i("nxentry")||"NX_P01308"};var j=function(a){return"NX_"!==a.substring(0,3)&&(a="NX_"+a),a},k=function(a,c){return new Promise(function(d,e){var h=new XMLHttpRequest,i=b+a+"/"+c+".json?clientInfo="+g+"&applicationName="+f;h.open("GET",i),h.onload=function(){200==h.status?d(JSON.parse(h.responseText)):e(Error(h.status))},h.onerror=function(){e(Error("Network Error"))},h.send()})};h.prototype.executeSparql=function(a){var b=e+a,h=c+d+"&query="+encodeURIComponent(b)+"&clientInfo="+g+"&applicationName="+f;return Promise.resolve($.getJSON(h)).then(function(a){return a})},h.prototype.getProteinOverview=function(a){return k(j(a||this.getEntryName()),"overview").then(function(a){return a.entry.overview})},h.prototype.getProteinSequence=function(a){return k(j(a||this.getEntryName()),"isoform").then(function(a){return a.entry.isoforms})},h.prototype.getSecondaryStructure=function(a){return k(j(a||this.getEntryName()),"secondary-structure").then(function(a){return a.entry.annotations})},h.prototype.getMatureProtein=function(a){return k(j(a||this.getEntryName()),"mature-protein").then(function(a){return{annot:a.entry.annotations,publi:a.entry.publications,xrefs:a.entry.xrefs}})},h.prototype.getPeptide=function(a){return k(j(a||this.getEntryName()),"peptide-mapping").then(function(a){return a.entry.peptideMappings})},h.prototype.getSrmPeptide=function(a){return k(j(a||this.getEntryName()),"srm-peptide-mapping").then(function(a){return a.entry.srmPeptideMappings})},h.prototype.getSignalPeptide=function(a){return k(j(a||this.getEntryName()),"signal-peptide").then(function(a){return a.entry.annotations})},h.prototype.getProPeptide=function(a){return k(j(a||this.getEntryName()),"propeptide").then(function(a){return a.entry.annotations})},h.prototype.getDisulfideBond=function(a){return k(j(a||this.getEntryName()),"disulfide-bond").then(function(a){return a.entry.annotations})},h.prototype.getAntibody=function(a){return k(j(a||this.getEntryName()),"antibody").then(function(a){return a.entry.antibodyMappings})},h.prototype.getInitMeth=function(a){return k(j(a||this.getEntryName()),"initiator-methionine").then(function(a){return{annot:a.entry.annotations,publi:a.entry.publications,xrefs:a.entry.xrefs}})},h.prototype.getModifResidue=function(a){return k(j(a||this.getEntryName()),"modified-residue").then(function(a){return{annot:a.entry.annotations,publi:a.entry.publications,xrefs:a.entry.xrefs}})},h.prototype.getCrossLink=function(a){return k(j(a||this.getEntryName()),"cross-link").then(function(a){return{annot:a.entry.annotations,publi:a.entry.publications,xrefs:a.entry.xrefs}})},h.prototype.getGlycoSite=function(a){return k(j(a||this.getEntryName()),"glycosylation-site").then(function(a){return a.entry.annotations})},h.prototype.getInteractingRegion=function(a){return k(j(a||this.getEntryName()),"interacting-region").then(function(a){return a.entry.annotations})},h.prototype.getMiscellaneousSite=function(a){return k(j(a||this.getEntryName()),"miscellaneous-site").then(function(a){return a.entry.annotations})},h.prototype.getActiveSite=function(a){return k(j(a||this.getEntryName()),"active-site").then(function(a){return a.entry.annotations})},h.prototype.getMetalBindingSite=function(a){return k(j(a||this.getEntryName()),"metal-binding-site").then(function(a){return a.entry.annotations})},h.prototype.getVariant=function(a){return k(j(a||this.getEntryName()),"variant").then(function(a){return a.entry.annotations})},h.prototype.getExons=function(a){return k(j(a||this.getEntryName()),"genomic-mapping").then(function(a){return a.entry.genomicMappings[0].isoformMappings})},h.prototype.getIsoformMapping=function(a){return k(j(a||this.getEntryName()),"isoform/mapping").then(function(a){return a})},h.prototype.getLipidationSite=function(a){return k(j(a||this.getEntryName()),"lipidation-site").then(function(a){return a.entry.annotations})},h.prototype.getTopologicalDomain=function(a){return k(j(a||this.getEntryName()),"topological-domain").then(function(a){return a.entry.annotations})},h.prototype.getTransmembraneRegion=function(a){return k(j(a||this.getEntryName()),"transmembrane-region").then(function(a){return a.entry.annotations})},h.prototype.getMutagenesis=function(a){return k(j(a||this.getEntryName()),"mutagenesis").then(function(a){return a.entry.annotations})},h.prototype.getSequenceConflict=function(a){return k(j(a||this.getEntryName()),"sequence-conflict").then(function(a){return a.entry.annotations})},h.prototype.getPeroxisomeTransitPeptide=function(a){return k(j(a||this.getEntryName()),"peroxisome-transit-peptide").then(function(a){return a.entry.annotations})},h.prototype.getMitochondrialTransitPeptide=function(a){return k(j(a||this.getEntryName()),"mitochondrial-transit-peptide").then(function(a){return a.entry.annotations})},h.prototype.getSelenocysteine=function(a){return k(j(a||this.getEntryName()),"selenocysteine").then(function(a){return a.entry.annotations})},h.prototype.getMiscellaneousRegion=function(a){return k(j(a||this.getEntryName()),"miscellaneous-region").then(function(a){return a.entry.annotations})},h.prototype.getDomain=function(a){return k(j(a||this.getEntryName()),"domain").then(function(a){return a.entry.annotations})},h.prototype.getRepeat=function(a){return k(j(a||this.getEntryName()),"repeat").then(function(a){return a.entry.annotations})},h.prototype.getCalciumBinding=function(a){return k(j(a||this.getEntryName()),"calcium-binding-region").then(function(a){return a.entry.annotations})},h.prototype.getZincFinger=function(a){return k(j(a||this.getEntryName()),"zinc-finger-region").then(function(a){return a.entry.annotations})},h.prototype.getDnaBinding=function(a){return k(j(a||this.getEntryName()),"dna-binding-region").then(function(a){return a.entry.annotations})},h.prototype.getMotif=function(a){return k(j(a||this.getEntryName()),"short-sequence-motif").then(function(a){return a.entry.annotations})},h.prototype.getBiasedRegion=function(a){return k(j(a||this.getEntryName()),"compositionally-biased-region").then(function(a){return a.entry.annotations})},h.prototype.getNucleotideBinding=function(a){return k(j(a||this.getEntryName()),"nucleotide-phosphate-binding-region").then(function(a){return a.entry.annotations})},h.prototype.getCoiledCoilRegion=function(a){return k(j(a||this.getEntryName()),"coiled-coil-region").then(function(a){return a.entry.annotations})},h.prototype.getBindingSite=function(a){return k(j(a||this.getEntryName()),"binding-site").then(function(a){return a.entry.annotations})},h.prototype.getCleavageSite=function(a){return k(j(a||this.getEntryName()),"cleavage-site").then(function(a){return a.entry.annotations})},h.prototype.getBetaStrand=function(a){return k(j(a||this.getEntryName()),"beta-strand").then(function(a){return a.entry.annotations})},h.prototype.getHelix=function(a){return k(j(a||this.getEntryName()),"helix").then(function(a){return a.entry.annotations})},h.prototype.getTurn=function(a){return k(j(a||this.getEntryName()),"turn").then(function(a){return[a.entry.annotations,a.entry.publications]})},"undefined"!=typeof exports&&(exports.Client=h),a.Nextprot.Client=h}()}(this);var numero=0,NXUtils={checkIsoformMatch:function(a,b){return a.endsWith("-"+b)},getSequenceForIsoform:function(a,b){var c=null;return a.forEach("number"==typeof b?function(a){a.uniqueName.endsWith("-"+b)&&(console.log("returning"+a.sequence),c=a.sequence)}:function(a){return a.uniqueName===b?a.sequence:void 0}),c},getLinkForFeature:function(a,b,c){if("peptide"===c){var d="https://db.systemsbiology.net/sbeams/cgi/PeptideAtlas/GetPeptide?searchWithinThis=Peptide+Name&searchForThis="+b+";organism_name=Human";return"<a href='"+d+"'>"+b+"</a>"}if("antibody"===c){var d=a;return"<a href='"+d+"'>"+b+"</a>"}if(a){var d="http://www.nextprot.org/db/term/"+a;return"<a href='"+d+"'>"+b+"</a>"}if("publication"===c){var d="http://www.nextprot.org/db/publication/"+a;return"<a href='"+d+"'>"+b+"</a>"}return b?b:""},convertMappingsToIsoformMap:function(a,b,c){var d=jQuery.extend([],a),e=!1;a instanceof Array||(e=!0,d=jQuery.extend([],a.annot),console.log("GOOOOOOOOOOOT OOOOONE !!!!!!!!!!!!!!!!!!!!!!!!!!"));var f={};d.forEach(function(d){if(d.hasOwnProperty("targetingIsoformsMap")){for(var g in d.targetingIsoformsMap)if(d.targetingIsoformsMap.hasOwnProperty(g)){var h=d.targetingIsoformsMap[g].firstPosition,i=d.targetingIsoformsMap[g].lastPosition,j=NXUtils.getLinkForFeature(d.cvTermAccessionCode,d.description),k=d.description,l=d.evidences.map(function(a){return a.assignedBy}).filter(function(a,b,c){return c.indexOf(a)==b}),m=d.evidences.map(function(b){var c=null,d=null;if(e){for(var f in a.publi)if(a.publi[f].md5===b.publicationMD5){c=f;break}for(var g in a.xrefs)if(a.xrefs[g].dbXrefId===b.resourceId){d=a.xrefs[g],console.log("xreff"),console.log(d);break}return{evidenceCodeName:b.evidenceCodeName,assignedBy:b.assignedBy,publicationMD5:b.publicationMD5,title:c?NXUtils.getLinkForFeature(a.publi[c].publicationId,a.publi[c].title,"publication"):"",authors:c?a.publi[c].authors.map(function(a){return{lastName:a.lastName,initials:a.initials}}):[],journal:c?a.publi[c].cvJournal.name:"",volume:c?a.publi[c].volume:"",year:c?a.publi[c].publicationYear:"",firstPage:c?a.publi[c].firstPage:"",lastPage:c?""===a.publi[c].lastPage?a.publi[c].firstPage:a.publi[c].lastPage:"",pubId:c?a.publi[c].publicationId:"","abstract":c?a.publi[c].abstractText:"",dbXrefs:c?a.publi[c].dbXrefs.map(function(a){return{name:"DOI"===a.databaseName?"Full Text":a.databaseName,url:a.resolvedUrl,accession:a.accession}}):[],crossRef:d?{name:d.accession,url:d.resolvedUrl}:{}}}return{evidenceCodeName:b.evidenceCodeName,assignedBy:b.assignedBy,publicationMD5:b.publicationMD5,title:"",authors:[],journal:"",volume:"","abstract":""}});d.hasOwnProperty("variant")&&!jQuery.isEmptyObject(d.variant)&&(j="<span style='color:#00C500'>"+d.variant.original+" → "+d.variant.variant+"</span>",k='<span style="color:#00C500">'+d.variant.original+" → "+d.variant.variant+"</span>  ",d.variant.description&&(k+=d.variant.description)),f[g]||(f[g]=[]),f[g].push({start:h,end:i,length:i-h+1,id:b.replace(/\s/g,"")+"_"+h.toString()+"_"+i.toString(),description:k,category:b,group:c,link:j,evidence:l,evidenceLength:m.length,source:m})}}else if(d.hasOwnProperty("isoformSpecificity"))for(var g in d.isoformSpecificity)if(d.isoformSpecificity.hasOwnProperty(g))for(var n=0;n<d.isoformSpecificity[g].positions.length;n++){var h=d.isoformSpecificity[g].positions[n].first,i=d.isoformSpecificity[g].positions[n].second,l="",k="",j="",m=[];if(d.hasOwnProperty("evidences")?(m=d.evidences.map(function(a){return{evidenceCodeName:a.evidenceCodeName,assignedBy:a.assignedBy,publicationMD5:a.publicationMD5}}),l=d.evidences.map(function(a){return a.assignedBy}).filter(function(a,b,c){return c.indexOf(a)==b})):l=[d.assignedBy],d.hasOwnProperty("xrefs"))k=d.xrefs[0].accession,j=NXUtils.getLinkForFeature(d.xrefs[0].resolvedUrl,k,"antibody");else{k=d.evidences[0].accession;for(ev in d.evidences)if("PeptideAtlas"===d.evidences[ev].databaseName||"SRMAtlas"===d.evidences[ev].databaseName){k=d.evidences[ev].accession,j=NXUtils.getLinkForFeature(k,k,"peptide");break}}f[g]||(f[g]=[]),f[g].push({start:h,end:i,length:i-h,id:b.replace(/\s/g,"")+"_"+h.toString()+"_"+i.toString(),description:k,category:b,group:c,link:j,evidence:l,evidenceLength:m.length,source:m})}}),numero+=1;for(var g in f)f[g].sort(function(a,b){return a.start-b.start});return console.log(f),f},convertPublications:function(a,b){console.log(a);for(var c in a)b[a[c].md5]={title:a[c].title,author:a[c].authors.map(function(a){return{lastName:a.lastName,initials:a.initials}}),journal:a[c].cvJournal.name,volume:a[c].volume,"abstract":a[c].abstractText};console.log(b)},convertExonsMappingsToIsoformMap:function(a){return a.map(function(a){return{uniqueName:a.uniqueName,isoMainName:a.isoMainName,mapping:a.positionsOfIsoformOnReferencedGene.map(function(a){return{start:a.key,end:a.value}})}})}},NXViewerUtils={convertNXAnnotations:function(a,b){if(!a)return"Cannot load this";var c={};for(name in a){var d=jQuery.extend({},b);d.data=a[name].map(function(a){return{x:a.start,y:a.end,id:a.id,category:a.category,description:a.description}}),c[name]=d}return c}};