<html>
<head>
  <title>neXtProt secondary structure</title>
  <link rel="stylesheet" href="../vendor/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../vendor/css/pviz-core.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.0/handlebars.min.js"></script>
  <script src="../vendor/js/pviz-bundle.min.js"></script>
  <script src="../src/nextprot.js"></script>
</head>
<body class="container">

  <div id="nx-overview" class="row" style="width:850px; height:auto;"></div>

  <!-- min-width is for http://bl.ocks.org/ iframe (doc width sometimes 0 at init time)-->
  <div id="main" class="row" style="width:720px; height:200px;"></div>
  <h5>Sequence (<span id="sequenceLength"></span>) :</h5>
  <textarea disabled id="sequence" rows="6" cols="100" style="font-size: 12px;"></textarea>
  <h5>Secondary strucutre features number: (<span id="numberOfFeatures"></span>)</h5>

  <script class="example">
  var pviz = this.pviz;

  var Nextprot = window.Nextprot;
  var nx = new Nextprot.Client();

  nx.getProteinOverview().then(function (overview){
    $("#entryName").text(overview.proteinNames[0].synonymName);
    $("#geneName").text(overview.geneNames[0].synonymName);
    $("#proteinEvidence").text(overview.history.proteinExistence);
  });

  nx.getProteinSequence().then(function (sequence){

    $("#sequence").text(sequence[0].sequence);
    $("#sequenceLength").text(sequence[0].sequence.length);

    var seq = sequence[0].sequence;
    var seqEntry = new pviz.SeqEntry({
      sequence : seq
    });

    var view = new pviz.SeqEntryAnnotInteractiveView({
      model : seqEntry,
      el : '#main',
    })

    //Setting secondary structure
    nx.getSecondaryStructure().then(function (annotations){
      var features = [];
      $("#numberOfFeatures").text(annotations.length);
      annotations.forEach(function(annot){
        var isoform1 = nx.getEntryName() + "-1";
        features.push({
          category: 'secondary structure',
          type: (annot.category === "beta strand") ? "beta_strand" : annot.category ,
          start: annot.targetingIsoformsMap[isoform1].firstPosition,
          end: annot.targetingIsoformsMap[isoform1].lastPosition
        });
      });

      //Adding features
      seqEntry.addFeatures(features);
    })

    //Render at the end
    view.render();



  });



  </script>
  <script src="../src/nextprot-templates.js"></script>

</body>
</html>
